package application.modele;

import java.util.ArrayList;
import java.util.Random;

import application.vue.JeuVue;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;

public class Jeu {
	private int [][] codeTuiles = {
		{41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,38,39,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,56,57,41,41,41},
			{386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,38,39,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,386,41,41,56,57,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,26,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,26,41},
			{41,41,41,41,41,41,41,38,39,41,41,41,41,41,41,41,41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,56,57,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,38,39,41,41,41,38,39,41,41,41,38,39,41,41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,44,41,41},
			{41,41,41,41,41,56,57,41,41,41,56,57,41,41,41,56,57,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,38,39,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41,41,38,39,41,41,41,41,41,41,41,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,56,57,41,41},
			{41,41,41,41,41,41,38,39,41,41,41,41,56,57,41,41,41,41,56,57,41,41,41,41,41,41,41,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,26,41},
			{41,41,41,41,41,41,56,57,41,38,39,41,41,41,41,38,39,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,56,57,41,38,39,41,56,57,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,38,39},
			{41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,41,41,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41,41,41,41,41,41,56,57},
			{41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,41,41,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,38,39,41,56,57,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,41,41,41,41,41,41,38,39,41,56,57,41,41,41,41,38,39,41,41,41,38,39,41,41},
			{41,38,39,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41,386,386,386,386,386,386,41,41,41,41,41,41,56,57,41,41,41,41,41,41,41,56,57,41,41,41,56,57,41,41},
			{41,56,57,41,41,41,41,41,41,41,41,41,38,39,41,41,41,41,41,41,41,41,56,57,41,41,41,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41,386,386,386,386,386,386,41,41,41,41,38,39,41,41,41,38,39,41,41,41,41,41,41,41,38,39,41,41,41,41},
			{41,38,39,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41,386,386,386,386,386,386,41,41,41,41,56,57,41,41,41,56,57,41,41,41,41,41,41,41,56,57,41,41,41,41},
			{41,56,57,41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,56,57,41,41,41,386,386,386,386,386,386,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,41,41,41,41,41,17,17,17,17,17,17,41,41,41,17,41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41,41,41,41},
			{41,38,39,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,17,17,17,17,17,17,17,17,41,17,17,17,41,41,41,41,38,39,41,41,41,41,41,56,57,41,41,41,41,41,41},
			{41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,56,57,41,17,17,17,17,67,68,17,17,17,17,17,17,17,41,41,41,41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,38,39,41,41,41,41,41,41,41,41,41,41,41,17,17,17,67,67,68,67,68,17,17,17,17,17,41,41,41,41,41,41,41,41,41,38,39,41,41,41,41,41,41,41,41},
			{41,38,39,41,41,41,41,41,41,41,41,41,56,57,41,41,41,41,41,41,41,41,38,39,41,17,67,68,67,67,68,67,67,68,17,67,67,67,41,41,41,41,41,41,41,41,41,56,57,41,41,41,41,41,41,41,41},
			{41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,56,57,41,65,67,68,67,67,68,67,67,68,74,67,67,67,41,41,41,41,38,39,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,65,67,68,67,67,68,67,67,68,74,67,67,67,41,41,41,41,56,57,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,38,39,41,65,67,68,67,67,68,67,67,68,74,67,67,67,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,56,57,41,65,67,68,67,67,68,67,67,68,74,67,67,67,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41},
			{41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,65,67,67,67,67,67,67,67,67,74,67,67,67,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41,41}};

	private int largeur = 57;
	private int hauteur = 42;
	private ArrayList<Ennemis> listEnnemis ;
	private static Random random = new Random();
	private int nbEnnemis ;
	public boolean jeuEstFini = false;
	private ObservableList<Projectile> listeProjectile;
	private ObservableList<Tours> listeTours;


	public Jeu(int x, int y) {		
		this.largeur = x;
		this.hauteur = y;
		this.listEnnemis = new ArrayList<Ennemis>();
		this.nbEnnemis = 0;
		this.listeTours= FXCollections.observableArrayList() ;
		this.listeProjectile= FXCollections.observableArrayList() ;
	}
	
	public void creationNouveauEnnemi() {	
		int nbRdmEnnemis = getRandomInt(5,50);
		if(nbEnnemis < nbRdmEnnemis) {
			int e  = getRandomInt(1, 3);
			Ennemis ennemi;		
			switch(e) {
			case 1:
				ennemi = new Bebe(this);
				this.listEnnemis.add(ennemi);
				System.out.println("ajout Bebe");
				break;
			case 2:
				ennemi = new Adolescent(this);
				System.out.println(ennemi);
				this.listEnnemis.add(ennemi);
				System.out.println("ajout Adolescent");
				break;
			case 3:
				ennemi = new Enfant(this);
				this.listEnnemis.add(ennemi);		
				System.out.println("ajout Enfant");
			}
			nbEnnemis++;
		}
	}
	
	public static int getRandomInt(int min, int max){
		return random.nextInt(max - min + 1) + min;
	}
	
	public void setListEnnemis(ArrayList<Ennemis> listEnnemis) {
		this.listEnnemis = listEnnemis;
	}

	public ArrayList<Ennemis> getListEnnemis(){
		return this.listEnnemis;
	}
	
	public int getLargeur() {
		return this.largeur;
	}
	
	
	public int getHauteur() {
		return this.hauteur;
	}
	
	public int getCodeUneTuile(int x, int y) {
		return codeTuiles[y][x];
	} 
	
	public ObservableList<Projectile> getListeProjectile(){
		return listeProjectile;    
	}

	public void ajouterTours(Tours tour){
		listeTours.add(tour);
	}

	public ObservableList<Tours> getListeActeurs() {
		return listeTours;
	}

	public void tourDeJeuActeur() {
        for(int i = 0; i < listeTours.size(); i++) {
        	Tours a= listeTours.get(i);
        	//System.out.println( listeActeur.get(i).getId()+ " va bouger");
        	a.agit();
        }
	}

	public void tourDeJeuProjectile() {
        for (int j=0; j< listeProjectile.size(); j++) {
        	Projectile p= listeProjectile.get(j);
        	//p.agit();
        }
    }

	public double placerTourelleMilieuTuileCoordonnee(double coordonnee) {
		
		double newX;		
		if(coordonnee %16 > 8) {		
			newX= coordonnee-(coordonnee%16 - 8);
		}
		else if(coordonnee%16 < 8) {
			newX=coordonnee+(8 - coordonnee%16);
		}
		else {
			newX=coordonnee;
		}
		
		return newX;
	}

	
	public void unTour(int nbTour, JeuVue jeuVueEnnemis) {
		int espacement = Jeu.getRandomInt(3,5);		
		if (nbTour % espacement == 0) {
			System.out.println(getListEnnemis());	
			this.creationNouveauEnnemi();
			System.out.println("Les ennemis ne vont pas tarder à vous attaquer");
			jeuVueEnnemis.afficheEnnemis(this.getListEnnemis());
		}
		for (Ennemis ennemis : this.getListEnnemis()) {
			ennemis.seDeplace();
			if(ennemis.atteintMaison()) {
				this.jeuEstFini=true;
			}
		}
	}
}
/*
 * 
 * 																"rendons les choses compliquées, simples."
 * 
*/